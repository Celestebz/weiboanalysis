name: Daily Weibo Product Analysis

on:
  schedule:
    # åŒ—äº¬æ—¶é—´æ¯å¤©æ—©ä¸Š 6:00 (UTC 22:00 å‰ä¸€å¤©)
    - cron: '0 22 * * *'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  analyze:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # å…è®¸å†™å…¥ä»“åº“ï¼ˆå¦‚æœéœ€è¦æäº¤æŠ¥å‘Šï¼‰

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r skills/weibo-product-analysis/requirements.txt

      - name: Run Analysis
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          WEIBO_API_URL: ${{ secrets.WEIBO_API_URL }}
        run: |
          mkdir -p reports
          # ç›´æ¥åœ¨æ ¹ç›®å½•è¿è¡Œï¼Œé¿å… cd å¸¦æ¥çš„è·¯å¾„å›°æ‰°
          python skills/weibo-product-analysis/weibo_analysis.py --output reports/daily_report_$(date +'%Y%m%d').html
          
          # Debug: æ‰“å°ç›®å½•ç»“æ„æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ç”Ÿæˆ
          echo "ğŸ“‚ Listing reports directory:"
          ls -R reports/

      - name: Upload Report Artifact
        uses: actions/upload-artifact@v4
        with:
          name: weibo-analysis-report
          path: reports/
          if-no-files-found: error
          retention-days: 7
