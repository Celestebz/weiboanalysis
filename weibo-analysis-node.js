#!/usr/bin/env node
/**
 * å¾®åšçƒ­æœåˆ†æ - Node.jså®ç°ç‰ˆæœ¬
 * æ–œæ å‘½ä»¤ /weibo-analysis çš„æ ¸å¿ƒå®ç°
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * - å‘½ä»¤è¡Œ: node weibo-analysis-node.js
 * - æ–œæ å‘½ä»¤: /weibo-analysis
 */

const https = require('https');
const fs = require('fs');

// ==================== é…ç½®å¸¸é‡ ====================

// ç™¾åº¦åƒå¸†AIæœç´¢APIé…ç½®
const BAIDU_API_URL = "https://qianfan.baidubce.com/v2/ai_search/web_search";
const BAIDU_API_KEY = "bce-v3/ALTAK-L6TPvDXqOGEqEIB2Ogh0z/4432bd66294ce9b19fdca57204bd2024c8e40db6";

// å¾®åšçƒ­æœAPIé…ç½®
const WEIBO_API_URL = "https://apis.tianapi.com/weibohot/index";
const WEIBO_API_KEY = "ab1cca5ccb089e4bed812457b6b1155a";

// ==================== å·¥å…·å‡½æ•° ====================

function printHeader() {
    console.log("=" .repeat(70));
    console.log("ğŸ”¥ å¾®åšçƒ­æœåˆ†æå‘½ä»¤ (/weibo-analysis)");
    console.log("=" .repeat(70));
    console.log(`â° æ‰§è¡Œæ—¶é—´: ${new Date().toLocaleString('zh-CN')}`);
    console.log("=" .repeat(70));
    console.log();
}

function httpRequest(options, data = null) {
    return new Promise((resolve, reject) => {
        const req = https.request(options, (res) => {
            let body = '';
            res.on('data', (chunk) => {
                body += chunk;
            });
            res.on('end', () => {
                try {
                    const jsonData = JSON.parse(body);
                    resolve(jsonData);
                } catch (e) {
                    resolve(body);
                }
            });
        });

        req.on('error', (e) => {
            reject(e);
        });

        if (data) {
            req.write(data);
        }

        req.end();
    });
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

// ==================== æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ====================

async function getWeiboHotData() {
    console.log("ğŸ“¡ æ­¥éª¤1: è·å–å¾®åšçƒ­æœæ•°æ®...");
    console.log("-".repeat(70));

    try {
        // å°è¯•å¾®åšAPI
        const url = `${WEIBO_API_URL}?key=${WEIBO_API_KEY}`;
        console.log(`ğŸŒ æ­£åœ¨è¯·æ±‚: ${WEIBO_API_URL}`);

        const data = await httpRequest({
            hostname: 'apis.tianapi.com',
            path: `/weibohot/index?key=${WEIBO_API_KEY}`,
            method: 'GET'
        });

        if (data.code === 200) {
            console.log("âœ… å¾®åšçƒ­æœæ•°æ®è·å–æˆåŠŸ");
            return data.result;
        } else {
            console.log(`âš ï¸ APIè¿”å›é”™è¯¯: ${data.msg}`);
            return null;
        }

    } catch (e) {
        console.log(`âŒ è·å–å¤±è´¥: ${e.message}`);
        console.log("ğŸ’¡ å°†ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®è¿›è¡Œæ¼”ç¤º");
        return createMockData();
    }
}

function createMockData() {
    console.log("ğŸ“ ç”Ÿæˆæ¨¡æ‹Ÿçƒ­æœæ•°æ®...");
    const mockData = {
        "list": [
            {"hotword": "2025å¹´æ–°å¹´å±•æœ›", "hotwordnum": " 1200000", "hottag": "çƒ­"},
            {"hotword": "AIæŠ€æœ¯æ–°çªç ´", "hotwordnum": " 856000", "hottag": "æ–°"},
            {"hotword": "æ–°èƒ½æºæ±½è½¦é”€é‡", "hotwordnum": " 743000", "hottag": "æ²¸"},
            {"hotword": "æ•™è‚²æ”¹é©æ–°æ”¿ç­–", "hotwordnum": " 621000", "hottag": ""},
            {"hotword": "æˆ¿åœ°äº§å¸‚åœºå›æš–", "hotwordnum": " 567000", "hottag": "çƒ­"},
            {"hotword": "ç›´æ’­å¸¦è´§æ–°è§„", "hotwordnum": " 489000", "hottag": "æ–°"},
            {"hotword": "è€ƒç ”æˆç»©å…¬å¸ƒ", "hotwordnum": " 456000", "hottag": ""},
            {"hotword": "é£Ÿå“å®‰å…¨æ–°æ ‡å‡†", "hotwordnum": " 423000", "hottag": ""},
            {"hotword": "ç¯ä¿æ”¿ç­–å‡çº§", "hotwordnum": " 398000", "hottag": "æ²¸"},
            {"hotword": "ç§‘æŠ€åˆ›æ–°å¥–", "hotwordnum": " 367000", "hottag": ""}
        ]
    };
    console.log("âœ… æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå®Œæˆ");
    return mockData;
}

async function searchTopicBackground(topic) {
    const postData = JSON.stringify({
        messages: [
            {
                content: `è¯¦ç»†æœç´¢ï¼š${topic}ï¼Œæä¾›äº‹ä»¶çš„å®Œæ•´èƒŒæ™¯ã€æ—¶é—´çº¿å’Œå½±å“`,
                role: "user"
            }
        ]
    });

    try {
        console.log(`  ğŸ” æœç´¢: ${topic.substring(0, 30)}...`);
        const result = await httpRequest({
            hostname: 'qianfan.baidubce.com',
            path: '/v2/ai_search/web_search',
            method: 'POST',
            headers: {
                'X-Appbuilder-Authorization': `Bearer ${BAIDU_API_KEY}`,
                'Content-Type': 'application/json',
                'Content-Length': Buffer.byteLength(postData)
            }
        }, postData);

        return result;
    } catch (e) {
        console.log(`  âš ï¸ æœç´¢å¤±è´¥: ${e.message}`);
        return null;
    }
}

function categorizeTopic(topicName) {
    const categoryKeywords = {
        "å¨±ä¹": ["å‰§é›†", "ç»¼è‰º", "ç”µå½±", "æ˜æ˜Ÿ", "æ¼”å‘˜"],
        "ç¤¾ä¼š": ["æ”¿ç­–", "è§„å®š", "äº‹ä»¶", "æ–°é—»", "ç¤¾ä¼š"],
        "ç»æµ": ["ç»æµ", "å¸‚åœº", "é”€å”®", "æŠ•èµ„", "é‡‘è"],
        "ç§‘æŠ€": ["AI", "æŠ€æœ¯", "åˆ›æ–°", "ç§‘æŠ€", "æ•°å­—"],
        "æ•™è‚²": ["è€ƒè¯•", "å­¦ä¹ ", "æ•™è‚²", "å­¦æ ¡", "å­¦ç”Ÿ"],
        "å¥åº·": ["å¥åº·", "åŒ»ç–—", "å…»ç”Ÿ", "ç”Ÿæ´»"],
        "æ–‡åŒ–": ["æ–‡åŒ–", "ä¼ ç»Ÿ", "è‰ºæœ¯", "å†å²"],
        "ä½“è‚²": ["ä½“è‚²", "è¿åŠ¨", "æ¯”èµ›", "å¥èº«"]
    };

    for (const [category, keywords] of Object.entries(categoryKeywords)) {
        if (keywords.some(keyword => topicName.includes(keyword))) {
            return category;
        }
    }
    return "å…¶ä»–";
}

function extractBackground(searchResult, topic) {
    if (!searchResult || !searchResult.references) {
        return {
            "status": "æœªè·å–åˆ°è¯¦ç»†èƒŒæ™¯",
            "sources": []
        };
    }

    const references = searchResult.references.slice(0, 3);
    const sources = references.map(ref => ({
        "title": ref.title || "",
        "url": ref.url || "",
        "content": (ref.content || "").substring(0, 200) + "...",
        "date": ref.date || ""
    }));

    return {
        "status": "èƒŒæ™¯ä¿¡æ¯è·å–æˆåŠŸ",
        "sources": sources
    };
}

function generateInsights(topic, category) {
    const insightsMap = {
        "å¨±ä¹": {
            "user_pain_point": "å¨±ä¹çƒ­ç‚¹ä¿¡æ¯ç¢ç‰‡åŒ–ï¼Œç¼ºä¹æ·±åº¦è§£è¯»",
            "market_opportunity": "å¨±ä¹å†…å®¹æ·±åº¦è§£è¯»å’ŒèƒŒæ™¯ä¿¡æ¯æœåŠ¡",
            "innovation_direction": "AIé©±åŠ¨çš„å¨±ä¹å†…å®¹åˆ†æå’Œçƒ­ç‚¹é¢„æµ‹ç³»ç»Ÿ"
        },
        "ç¤¾ä¼š": {
            "user_pain_point": "ç¤¾ä¼šäº‹ä»¶ä¿¡æ¯ä¸å®Œæ•´ï¼Œç¼ºä¹å…¨é¢äº†è§£",
            "market_opportunity": "ç¤¾ä¼šäº‹ä»¶æ·±åº¦æŠ¥é“å’Œå¤šè§’åº¦åˆ†æå¹³å°",
            "innovation_direction": "AIé©±åŠ¨çš„äº‹ä»¶å…³è”åˆ†æå’Œå½±å“è¯„ä¼°ç³»ç»Ÿ"
        },
        "ç»æµ": {
            "user_pain_point": "ç»æµä¿¡æ¯ä¸“ä¸šæ€§å¼ºï¼Œæ™®é€šäººéš¾ä»¥ç†è§£",
            "market_opportunity": "ç»æµä¿¡æ¯ç§‘æ™®å’Œå½±å“è§£è¯»æœåŠ¡",
            "innovation_direction": "AIé©±åŠ¨çš„ç»æµå½±å“åˆ†æå’Œä¸ªäººå†³ç­–æ”¯æŒç³»ç»Ÿ"
        },
        "ç§‘æŠ€": {
            "user_pain_point": "ç§‘æŠ€å‘å±•å¿«é€Ÿï¼ŒçŸ¥è¯†æ›´æ–°è·Ÿä¸ä¸Š",
            "market_opportunity": "ç§‘æŠ€çŸ¥è¯†æ™®åŠå’ŒæŠ€æœ¯åº”ç”¨æŒ‡å¯¼æœåŠ¡",
            "innovation_direction": "AIé©±åŠ¨çš„ç§‘æŠ€è¶‹åŠ¿é¢„æµ‹å’Œåº”ç”¨åœºæ™¯æ¨èç³»ç»Ÿ"
        },
        "å¥åº·": {
            "user_pain_point": "å¥åº·ä¿¡æ¯çœŸå‡éš¾è¾¨ï¼Œç¼ºä¹ä¸“ä¸šæŒ‡å¯¼",
            "market_opportunity": "å¥åº·ä¿¡æ¯éªŒè¯å’Œä¸ªæ€§åŒ–å»ºè®®å¹³å°",
            "innovation_direction": "AIé©±åŠ¨çš„å¥åº·é£é™©è¯„ä¼°å’Œé¢„é˜²å»ºè®®ç³»ç»Ÿ"
        }
    };

    return insightsMap[category] || {
        "user_pain_point": "ä¿¡æ¯è·å–æ¸ é“åˆ†æ•£ï¼Œç¼ºä¹æ•´åˆå’Œæ·±åº¦",
        "market_opportunity": "ä¿¡æ¯èšåˆå’Œæ·±åº¦åˆ†ææœåŠ¡å¹³å°",
        "innovation_direction": "AIé©±åŠ¨çš„ä¸ªæ€§åŒ–ä¿¡æ¯æ¨èå’Œä»·å€¼è¯„ä¼°ç³»ç»Ÿ"
    };
}

function generateProductIdeas(topic, category, searchResult) {
    const topic_lower = topic.toLowerCase();

    // åŸºäºå…·ä½“è¯é¢˜å†…å®¹ç”Ÿæˆé’ˆå¯¹æ€§åˆ›æ„
    const topicSpecificIdeas = {
        // è½¦å˜å­/é£Ÿå“ä»·æ ¼ç±»
        "è½¦å˜å­": {
            fun: {
                name: "è½¦å˜å­ä»·æ ¼ä½“æ„Ÿæ¸¸æˆ",
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 85,
                useful_score: 15,
                functions: [
                    "è½¦å˜å­ä»·æ ¼ä½“æ„Ÿé¢„æµ‹æ¸¸æˆ",
                    "å®æ—¶ä»·æ ¼æ¶¨è·ŒARå±•ç¤º",
                    "è½¦å˜å­ç”œåº¦æµ‹è¯•å°æ¸¸æˆ",
                    "äº§åœ°çŸ¥è¯†å¤§é—¯å…³",
                    "æœ‹å‹åœˆæ™’å•PK"
                ],
                target_users: ["ç¾é£Ÿçˆ±å¥½è€…", "å¹´è½»ç™½é¢†", "å­¦ç”Ÿç¾¤ä½“", "å®¶åº­ä¸»å¦‡"],
                value: "è®©ä»·æ ¼ç›‘æ§å˜æˆæœ‰è¶£çš„æ¸¸æˆä½“éªŒ"
            },
            useful: {
                name: "æ™ºèƒ½é£Ÿæä»·æ ¼è¿½è¸ªç³»ç»Ÿ",
                type: "ç§»åŠ¨APP",
                fun_score: 15,
                useful_score: 85,
                functions: [
                    "å¤šå¹³å°ä»·æ ¼å¯¹æ¯”ç›‘æ§",
                    "æœ€ä½³è´­ä¹°æ—¶æœºæé†’",
                    "è¥å…»ä»·å€¼æ™ºèƒ½åˆ†æ",
                    "æ›¿ä»£é£Ÿææ¨è",
                    "å®¶åº­é£Ÿæé¢„ç®—ç®¡ç†"
                ],
                target_users: ["å®¶åº­ä¸»å¦‡", "ç†è´¢è§„åˆ’è€…", "é¤å…é‡‡è´­", "è¥å…»å¸ˆ"],
                value: "ç§‘å­¦ç®¡ç†é£Ÿæé‡‡è´­ï¼ŒèŠ‚çœå®¶åº­å¼€æ”¯"
            }
        },

        // å“ˆå°”æ»¨/æ—…æ¸¸ç±»
        "å“ˆå°”æ»¨": {
            fun: {
                name: "æåœ°ä½“éªŒç”Ÿå­˜æ¸¸æˆ",
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 90,
                useful_score: 10,
                functions: [
                    "æåœ°æ°”æ¸©ä½“æ„ŸæŒ‘æˆ˜",
                    "ä¸œåŒ—è¯ç¿»è¯‘å™¨æ¸¸æˆ",
                    "å†°é›ªå»ºç­‘ARä½“éªŒ",
                    "å†»æ¢¨åˆ¶ä½œå°æ¸¸æˆ",
                    "ä¸œåŒ—æ–‡åŒ–çŸ¥è¯†ç«èµ›"
                ],
                target_users: ["æ—…æ¸¸çˆ±å¥½è€…", "å¹´è½»æ½®äºº", "å—æ–¹ç½‘å‹", "å†’é™©æ¸¸æˆç©å®¶"],
                value: "è¶³ä¸å‡ºæˆ·ä½“éªŒæåœ°æ–‡åŒ–ä¹è¶£"
            },
            useful: {
                name: "æåœ°æ—…æ¸¸è§„åˆ’åŠ©æ‰‹",
                type: "ç§»åŠ¨APP",
                fun_score: 20,
                useful_score: 80,
                functions: [
                    "æåœ°å¤©æ°”å®æ—¶é¢„è­¦",
                    "ä¿æš–è£…å¤‡æ¸…å•ç”Ÿæˆ",
                    "å½“åœ°ç¾é£Ÿæ¨è",
                    "äº¤é€šè·¯çº¿ä¼˜åŒ–",
                    "ç´§æ€¥æƒ…å†µå¤„ç†æŒ‡å—"
                ],
                target_users: ["æ—…æ¸¸è§„åˆ’è€…", "è‡ªç”±è¡Œæ¸¸å®¢", "æ‘„å½±çˆ±å¥½è€…", "é€€ä¼‘äººå‘˜"],
                value: "è®©æåœ°æ—…è¡Œå®‰å…¨èˆ’é€‚åˆæœ‰è¶£"
            }
        },

        // ç»æµæ”¿ç­–ç±»
        "é•¿æ±Ÿç»æµå¸¦": {
            fun: {
                name: "ç»æµå¸¦æ¨¡æ‹Ÿç»è¥æ¸¸æˆ",
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 75,
                useful_score: 25,
                functions: [
                    "åŸå¸‚å‘å±•ç­–ç•¥æ¨¡æ‹Ÿ",
                    "GDPå¢é•¿æŒ‘æˆ˜æ¸¸æˆ",
                    "åŒºåŸŸåˆä½œé—¯å…³",
                    "äº§ä¸šå‡çº§å†³ç­–",
                    "æŠ•èµ„ç†è´¢å°è¯¾å ‚"
                ],
                target_users: ["ç»æµå­¦çˆ±å¥½è€…", "å¤§å­¦ç”Ÿ", "æŠ•èµ„æ–°æ‰‹", "ç­–ç•¥æ¸¸æˆç©å®¶"],
                value: "é€šè¿‡æ¸¸æˆç†è§£ç»æµå‘å±•è§„å¾‹"
            },
            useful: {
                name: "åŒºåŸŸç»æµæŠ•èµ„åˆ†æå¹³å°",
                type: "Webå¹³å°",
                fun_score: 15,
                useful_score: 85,
                functions: [
                    "åŒºåŸŸGDPæ•°æ®å¯è§†åŒ–",
                    "æŠ•èµ„æœºä¼šæ™ºèƒ½æŒ–æ˜",
                    "æ”¿ç­–å½±å“è¯„ä¼°æŠ¥å‘Š",
                    "äº§ä¸šè¶‹åŠ¿é¢„æµ‹åˆ†æ",
                    "é£é™©ç­‰çº§è¯„ä¼°ç³»ç»Ÿ"
                ],
                target_users: ["æŠ•èµ„è€…", "ä¼ä¸šé«˜ç®¡", "é‡‘èåˆ†æå¸ˆ", "æ”¿ç­–ç ”ç©¶å‘˜"],
                value: "åŸºäºæ•°æ®æ´å¯ŸåŒºåŸŸæŠ•èµ„æœºä¼š"
            }
        },

        // å¨±ä¹/æ˜æ˜Ÿç±»
        "å†…å¨±": {
            fun: {
                name: "æ˜æ˜ŸCPé…å¯¹æ¸¸æˆ",
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 90,
                useful_score: 10,
                functions: [
                    "æ˜æ˜ŸCPåŒ–å­¦ååº”æµ‹è¯•",
                    "å©šçº±ç…§é£æ ¼æ¢è£…",
                    "ç²‰ä¸åº”æ´äº’åŠ¨æ¸¸æˆ",
                    "æ˜æ˜Ÿæœ€æ–°åŠ¨æ€æ¨é€",
                    "å¨±ä¹åœˆäº‹ä»¶æ¨¡æ‹Ÿå™¨"
                ],
                target_users: ["ç²‰ä¸ç¾¤ä½“", "å¨±ä¹å…«å¦çˆ±å¥½è€…", "å¹´è½»å¥³æ€§", "ç¤¾äº¤åª’ä½“ç”¨æˆ·"],
                value: "æ»¡è¶³ç²‰ä¸å¯¹æ˜æ˜Ÿå¨±ä¹çš„æƒ³è±¡"
            },
            useful: {
                name: "å¨±ä¹äº§ä¸šæ•°æ®åˆ†æå¹³å°",
                type: "Webå¹³å°",
                fun_score: 10,
                useful_score: 90,
                functions: [
                    "æ˜æ˜Ÿå•†ä¸šä»·å€¼è¯„ä¼°",
                    "å¨±ä¹å¸‚åœºè¶‹åŠ¿åˆ†æ",
                    "ç²‰ä¸ç»æµæ•°æ®æŒ–æ˜",
                    "å½±è§†æŠ•èµ„é£é™©è¯„ä¼°",
                    "å¨±ä¹è¡Œä¸šæŠ¥å‘Šç”Ÿæˆ"
                ],
                target_users: ["å¨±ä¹å…¬å¸", "æŠ•èµ„æœºæ„", "å¨±ä¹åª’ä½“", "è¡Œä¸šåˆ†æå¸ˆ"],
                value: "ä¸“ä¸šåˆ†æå¨±ä¹å¸‚åœºæŠ•èµ„ä»·å€¼"
            }
        },

        // æ¸¸æˆ/ç”µç«ç±»
        "è‹±é›„è”ç›Ÿ": {
            fun: {
                name: "å³¡è°·è‹±é›„è¯ä¹¦æ”¶é›†é¦†",
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 88,
                useful_score: 12,
                functions: [
                    "è‹±é›„æŠ€èƒ½äº’åŠ¨ä½“éªŒ",
                    "å³¡è°·åœºæ™¯ARæ‹ç…§",
                    "çš®è‚¤ç‰¹æ•ˆæ¨¡æ‹Ÿå™¨",
                    "æˆ˜ç»©æ•°æ®å¯è§†åŒ–",
                    "å¬å”¤å¸ˆç­‰çº§è¿›é˜¶"
                ],
                target_users: ["æ¸¸æˆç©å®¶", "ç”µç«çˆ±å¥½è€…", "å¹´è½»ç¾¤ä½“", "ç¤¾äº¤åˆ†äº«è€…"],
                value: "æ²‰æµ¸å¼ä½“éªŒè‹±é›„è”ç›Ÿä¸–ç•Œ"
            },
            useful: {
                name: "ç”µç«èŒä¸šå‘å±•è§„åˆ’å¹³å°",
                type: "Webå¹³å°",
                fun_score: 15,
                useful_score: 85,
                functions: [
                    "æŠ€èƒ½æ°´å¹³æµ‹è¯„ç³»ç»Ÿ",
                    "èŒä¸šç”µç«é€‰æ‰‹åŒ¹é…",
                    "æˆ˜é˜Ÿæ‹›å‹Ÿä¿¡æ¯èšåˆ",
                    "ç”µç«æ•™è‚²è¯¾ç¨‹æ¨è",
                    "èŒä¸šç”Ÿæ¶¯è·¯å¾„è§„åˆ’"
                ],
                target_users: ["ç”µç«é€‰æ‰‹", "æ¸¸æˆåŸ¹è®­æœºæ„", "ç”µç«ä¿±ä¹éƒ¨", "èŒä¸šè§„åˆ’å¸ˆ"],
                value: "ç§‘å­¦è§„åˆ’ç”µç«èŒä¸šå‘å±•è·¯å¾„"
            }
        },

        // ç¤¾ä¼šäº‹ä»¶/é“å¾·ç±»
        "ç‰©ä¸š": {
            fun: {
                name: "ç¤¾åŒºç”Ÿæ´»æ¨¡æ‹Ÿå™¨",
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 80,
                useful_score: 20,
                functions: [
                    "é‚»é‡Œå…³ç³»å…»æˆæ¸¸æˆ",
                    "ç‰©ä¸šæœåŠ¡æ»¡æ„åº¦æµ‹è¯•",
                    "ç¤¾åŒºæ´»åŠ¨ç»„ç»‡æ¨¡æ‹Ÿ",
                    "é‚»é‡Œäº’åŠ©ä»»åŠ¡ç³»ç»Ÿ",
                    "ç¤¾åŒºè¯„åˆ†æ’è¡Œæ¦œ"
                ],
                target_users: ["ç¤¾åŒºå±…æ°‘", "å¹´è½»å®¶åº­", "å°åŒºä¸šä¸»", "ç¤¾åŒºæ´»åŠ¨çˆ±å¥½è€…"],
                value: "è®©ç¤¾åŒºç”Ÿæ´»æ›´æœ‰è¶£æ›´å’Œè°"
            },
            useful: {
                name: "ç¤¾åŒºæ²»ç†æ•°å­—åŒ–å¹³å°",
                type: "Webå¹³å°",
                fun_score: 10,
                useful_score: 90,
                functions: [
                    "ç‰©ä¸šæœåŠ¡è´¨é‡è¯„ä¼°",
                    "ç¤¾åŒºé—®é¢˜æ™ºèƒ½åˆ†ç±»",
                    "ä¸šä¸»æƒç›Šä¿æŠ¤æœºåˆ¶",
                    "åº”æ€¥å“åº”æµç¨‹ä¼˜åŒ–",
                    "ç¤¾åŒºæ²»ç†æ•°æ®æŠ¥å‘Š"
                ],
                target_users: ["ç¤¾åŒºç®¡ç†è€…", "ç‰©ä¸šå…¬å¸", "ä¸šä¸»å§”å‘˜ä¼š", "æ”¿åºœéƒ¨é—¨"],
                value: "æå‡ç¤¾åŒºæ²»ç†æ•ˆç‡å’Œè´¨é‡"
            }
        },

        // è´¢å¯Œ/è¿åŠ¿ç±»
        "æ¥è´¢": {
            fun: {
                name: "è´¢è¿é¢„æµ‹å°æ¸¸æˆ",
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 95,
                useful_score: 5,
                functions: [
                    "ä»Šæ—¥è´¢è¿æŒ‡æ•°æµ‹è¯•",
                    "å¹¸è¿è‰²/å¹¸è¿æ•°å­—æ¨è",
                    "æ‹›è´¢çº³ç¦å°æ¸¸æˆ",
                    "ç†è´¢è¿åŠ¿åˆ†æ",
                    "æœ‹å‹åœˆè´¢è¿åˆ†äº«"
                ],
                target_users: ["å¹´è½»äºº", "èŒåœºç™½é¢†", "å­¦ç”Ÿç¾¤ä½“", "è¿·ä¿¡çˆ±å¥½è€…"],
                value: "ç”¨è½»æ¾æœ‰è¶£çš„æ–¹å¼é¢„æµ‹è´¢è¿"
            },
            useful: {
                name: "ä¸ªäººè´¢åŠ¡ç®¡ç†ç³»ç»Ÿ",
                type: "ç§»åŠ¨APP",
                fun_score: 15,
                useful_score: 85,
                functions: [
                    "æ”¶æ”¯æ˜ç»†è®°å½•",
                    "æŠ•èµ„ç»„åˆå»ºè®®",
                    "é£é™©è¯„ä¼°åˆ†æ",
                    "è´¢åŠ¡ç›®æ ‡è§„åˆ’",
                    "ç†è´¢çŸ¥è¯†å­¦ä¹ "
                ],
                target_users: ["èŒåœºäººå£«", "ç†è´¢æ–°æ‰‹", "å®¶åº­ç®¡ç†è€…", "æŠ•èµ„è€…"],
                value: "ç§‘å­¦ç®¡ç†ä¸ªäººè´¢åŠ¡å¢é•¿è´¢å¯Œ"
            }
        },

        // å®‰å…¨/æˆ·å¤–ç±»
        "é»„å±±": {
            fun: {
                name: "ç™»å±±å®‰å…¨çŸ¥è¯†é—¯å…³",
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 75,
                useful_score: 25,
                functions: [
                    "ç™»å±±å®‰å…¨çŸ¥è¯†ç«èµ›",
                    "åº”æ€¥å¤„ç†å°æ¸¸æˆ",
                    "è£…å¤‡é€‰æ‹©æ¨¡æ‹Ÿ",
                    "è·¯çº¿éš¾åº¦æµ‹è¯•",
                    "å®‰å…¨æ„è¯†è¯„åˆ†"
                ],
                target_users: ["ç™»å±±çˆ±å¥½è€…", "æˆ·å¤–è¿åŠ¨è€…", "å­¦ç”Ÿç¾¤ä½“", "å†’é™©æ¸¸æˆç©å®¶"],
                value: "å¯“æ•™äºä¹æå‡ç™»å±±å®‰å…¨æ„è¯†"
            },
            useful: {
                name: "æˆ·å¤–å®‰å…¨é¢„è­¦å¹³å°",
                type: "Webå¹³å°",
                fun_score: 10,
                useful_score: 90,
                functions: [
                    "å¤©æ°”é£é™©å®æ—¶ç›‘æµ‹",
                    "åœ°è´¨å±é™©åŒºåŸŸæ ‡è¯†",
                    "æ•‘æ´èµ„æºåˆ†å¸ƒå›¾",
                    "åº”æ€¥é€šè®¯ä¿éšœ",
                    "å®‰å…¨äº‹ä»¶è®°å½•åˆ†æ"
                ],
                target_users: ["æˆ·å¤–ä¿±ä¹éƒ¨", "æ•‘æ´æœºæ„", "æ—…æ¸¸éƒ¨é—¨", "æˆ·å¤–è¿åŠ¨ç»„ç»‡"],
                value: "æ„å»ºæˆ·å¤–è¿åŠ¨å®‰å…¨é˜²æŠ¤ç½‘"
            }
        },

        // æ•™è‚²ç±»
        "è¯„æ•™": {
            fun: {
                name: "æ•™å­¦äº’åŠ¨è¶£å‘³è¯„åˆ†",
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 80,
                useful_score: 20,
                functions: [
                    "è¯¾å ‚äº’åŠ¨è¶£å‘³è°ƒæŸ¥",
                    "æ•™å¸ˆé­…åŠ›å€¼è¯„ä¼°",
                    "çŸ¥è¯†ç‚¹æŒæ¡æµ‹è¯•",
                    "å­¦ä¹ æ°›å›´æ„Ÿå—åˆ†äº«",
                    "å¸ˆç”Ÿå…³ç³»æ»¡æ„åº¦"
                ],
                target_users: ["åœ¨æ ¡å­¦ç”Ÿ", "å¹´è½»æ•™å¸ˆ", "æ•™è‚²å·¥ä½œè€…", "å­¦æ ¡ç®¡ç†è€…"],
                value: "è®©æ•™å­¦è¯„ä»·æ›´æœ‰è¶£æ›´çœŸå®"
            },
            useful: {
                name: "æ•™å­¦è´¨é‡æ”¹è¿›åˆ†æå¹³å°",
                type: "Webå¹³å°",
                fun_score: 15,
                useful_score: 85,
                functions: [
                    "å¤šç»´åº¦æ•™å­¦è´¨é‡åˆ†æ",
                    "æ•™å¸ˆå‘å±•è·¯å¾„å»ºè®®",
                    "å­¦ç”Ÿåé¦ˆæ™ºèƒ½å¤„ç†",
                    "æ•™å­¦æ”¹é©æ•ˆæœè¯„ä¼°",
                    "æ•™è‚²èµ„æºä¼˜åŒ–é…ç½®"
                ],
                target_users: ["å­¦æ ¡ç®¡ç†è€…", "æ•™è‚²ä¸»ç®¡éƒ¨é—¨", "æ•™ç ”å‘˜", "æ•™è‚²ç ”ç©¶è€…"],
                value: "æ•°æ®é©±åŠ¨æ•™å­¦è´¨é‡æŒç»­æ”¹è¿›"
            }
        },

        // åŒ»ç–—/ç”Ÿè‚²ç±»
        "æ€€å­•": {
            fun: {
                name: "å­•æœŸå¥‡å¦™ä½“éªŒé¦†",
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 85,
                useful_score: 15,
                functions: [
                    "èƒå„¿å‘è‚²ARå±•ç¤º",
                    "å­•æœŸç—‡çŠ¶å°æ¸¸æˆ",
                    "èƒåŠ¨äº’åŠ¨è®°å½•",
                    "å­•æœŸæ—¥è®°åˆ¶ä½œ",
                    "å®å®æœªæ¥é¢„æµ‹å™¨"
                ],
                target_users: ["å‡†å¦ˆå¦ˆ", "å¤‡å­•å¤«å¦‡", "å®¶åº­æˆå‘˜", "æ¯å©´çˆ±å¥½è€…"],
                value: "è®©å­•æœŸä½“éªŒæ›´åŠ æ¸©é¦¨æœ‰è¶£"
            },
            useful: {
                name: "å­•æœŸå¥åº·ç®¡ç†åŠ©æ‰‹",
                type: "ç§»åŠ¨APP",
                fun_score: 15,
                useful_score: 85,
                functions: [
                    "äº§æ£€æ—¶é—´æ™ºèƒ½æé†’",
                    "å­•æœŸé£é™©è¯„ä¼°",
                    "è¥å…»æ‘„å…¥å»ºè®®",
                    "èƒå„¿å‘è‚²ç›‘æµ‹",
                    "ä¸“ä¸šåŒ»ç”Ÿå’¨è¯¢"
                ],
                target_users: ["å‡†å¦ˆå¦ˆ", "å¦‡äº§ç§‘åŒ»ç”Ÿ", "å­•æœŸå®¶åº­", "æ¯å©´æŠ¤ç†å¸ˆ"],
                value: "å…¨æ–¹ä½ä¿éšœæ¯å©´å¥åº·å®‰å…¨"
            }
        }
    };

    // æ™ºèƒ½åŒ¹é…å…·ä½“è¯é¢˜
    for (const [keyword, ideas] of Object.entries(topicSpecificIdeas)) {
        if (topic.includes(keyword) || topic_lower.includes(keyword)) {
            console.log(`  ğŸ¯ ç‰¹æ®Šåˆ›æ„ç”Ÿæˆ: æ£€æµ‹åˆ°å…³é”®è¯"${keyword}"`);
            return [ideas.fun, ideas.useful];
        }
    }

    // æ£€æŸ¥æ›´å¤šç‰¹æ®Šå…³é”®è¯
    const specialKeywords = {
        'ç¾½ç»’æœ': 'ç¾½ç»’æœ',
        'åŒ»ä¿': 'åŒ»ä¿',
        'é«˜æ•°': 'é«˜æ•°',
        'ç¿¼è£…': 'ç¿¼è£…',
        'è‹¹æœ': 'è‹¹æœ',
        'åˆ›å§‹äºº': 'åˆ›å§‹äºº',
        'Manus': 'Manus'
    };

    for (const [key, value] of Object.entries(specialKeywords)) {
        if (topic.includes(key) || topic_lower.includes(key)) {
            console.log(`  ğŸ¯ ç‰¹æ®Šåˆ›æ„ç”Ÿæˆ: æ£€æµ‹åˆ°å…³é”®è¯"${value}"`);
            return generateSpecialIdea(topic, value, searchResult);
        }
    }

    // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°å…·ä½“åˆ›æ„ï¼ŒåŸºäºè¯é¢˜ç‰¹å¾ç”Ÿæˆ
    return generateGenericCreativeIdeas(topic, category, searchResult);
}

function generateGenericCreativeIdeas(topic, category, searchResult) {
    // æå–æœç´¢ç»“æœä¸­çš„å…³é”®ä¿¡æ¯
    let contextInfo = "";
    if (searchResult && searchResult.references && searchResult.references.length > 0) {
        const firstRef = searchResult.references[0];
        if (firstRef.content) {
            // æå–å‰100ä¸ªå­—ç¬¦ä½œä¸ºä¸Šä¸‹æ–‡
            contextInfo = firstRef.content.substring(0, 100);
        }
    }

    // åŸºäºåˆ†ç±»å’Œä¸Šä¸‹æ–‡ç”Ÿæˆåˆ›æ„
    const categoryIdeas = {
        "å¨±ä¹": {
            fun: {
                name: `${topic.substring(0, 6)}å¨±ä¹äº’åŠ¨ç«™`,
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 85,
                useful_score: 15,
                functions: ["äº’åŠ¨é—®ç­”", "å†…å®¹åˆ›ä½œ", "ç²‰ä¸äº’åŠ¨", "å¨±ä¹èµ„è®¯", "ç¤¾äº¤åˆ†äº«"],
                target_users: ["å¨±ä¹çˆ±å¥½è€…", "ç²‰ä¸ç¾¤ä½“", "å¹´è½»ç”¨æˆ·", "å†…å®¹åˆ›ä½œè€…"],
                value: "è®©å¨±ä¹ä½“éªŒæ›´åŠ äº’åŠ¨æœ‰è¶£"
            },
            useful: {
                name: "å¨±ä¹äº§ä¸šæ´å¯Ÿåˆ†æ",
                type: "Webå¹³å°",
                fun_score: 15,
                useful_score: 85,
                functions: ["å¸‚åœºåˆ†æ", "è¶‹åŠ¿é¢„æµ‹", "æŠ•èµ„è¯„ä¼°", "æ•°æ®å¯è§†åŒ–", "è¡Œä¸šæŠ¥å‘Š"],
                target_users: ["æŠ•èµ„æœºæ„", "å¨±ä¹å…¬å¸", "è¡Œä¸šåˆ†æå¸ˆ", "åª’ä½“ä»ä¸šè€…"],
                value: "ä¸“ä¸šæ´å¯Ÿå¨±ä¹å¸‚åœºæŠ•èµ„æœºä¼š"
            }
        },

        "ç»æµ": {
            fun: {
                name: `${topic.substring(0, 6)}ç»æµæ¨¡æ‹Ÿå™¨`,
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 80,
                useful_score: 20,
                functions: ["ç»æµæ¨¡æ‹Ÿæ¸¸æˆ", "æŠ•èµ„ä½“éªŒ", "å¸‚åœºé¢„æµ‹", "ç­–ç•¥å†³ç­–", "æ’è¡Œæ¦œ"],
                target_users: ["ç»æµå­¦çˆ±å¥½è€…", "æŠ•èµ„æ–°æ‰‹", "å¤§å­¦ç”Ÿ", "ç­–ç•¥æ¸¸æˆç©å®¶"],
                value: "è½»æ¾å­¦ä¹ ç»æµæŠ•èµ„çŸ¥è¯†"
            },
            useful: {
                name: "ç»æµæ•°æ®æ™ºèƒ½åˆ†æ",
                type: "Webå¹³å°",
                fun_score: 15,
                useful_score: 85,
                functions: ["æ•°æ®åˆ†æ", "è¶‹åŠ¿é¢„æµ‹", "é£é™©è¯„ä¼°", "æŠ•èµ„å»ºè®®", "å†³ç­–æ”¯æŒ"],
                target_users: ["æŠ•èµ„è€…", "ä¼ä¸šé«˜ç®¡", "é‡‘èåˆ†æå¸ˆ", "ç»æµå­¦è€…"],
                value: "æ•°æ®é©±åŠ¨ç»æµå†³ç­–ä¼˜åŒ–"
            }
        },

        "ç§‘æŠ€": {
            fun: {
                name: `${topic.substring(0, 6)}ç§‘æŠ€ä½“éªŒé¦†`,
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 85,
                useful_score: 15,
                functions: ["ç§‘æŠ€ä½“éªŒ", "æ¦‚å¿µç§‘æ™®", "æœªæ¥æƒ³è±¡", "äº’åŠ¨å®éªŒ", "åˆ›å®¢ç©ºé—´"],
                target_users: ["ç§‘æŠ€çˆ±å¥½è€…", "å­¦ç”Ÿç¾¤ä½“", "åˆ›å®¢", "æœªæ¥ä¸»ä¹‰è€…"],
                value: "è®©ç§‘æŠ€çŸ¥è¯†å˜å¾—æœ‰è¶£æ˜“æ‡‚"
            },
            useful: {
                name: "ç§‘æŠ€åˆ›æ–°åº”ç”¨å¹³å°",
                type: "Webå¹³å°",
                fun_score: 15,
                useful_score: 85,
                functions: ["æŠ€æœ¯åˆ†æ", "åº”ç”¨è¯„ä¼°", "è¶‹åŠ¿é¢„æµ‹", "æŠ•èµ„å»ºè®®", "äº§ä¸šç ”ç©¶"],
                target_users: ["ç§‘æŠ€ä¼ä¸š", "æŠ•èµ„æœºæ„", "æŠ€æœ¯ä¸“å®¶", "åˆ›æ–°åˆ›ä¸šè€…"],
                value: "åŠ é€Ÿç§‘æŠ€æˆæœè½¬åŒ–åº”ç”¨"
            }
        },

        "ç¤¾ä¼š": {
            fun: {
                name: `${topic.substring(0, 6)}ç¤¾ä¼šè§‚å¯Ÿ`,
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 75,
                useful_score: 25,
                functions: ["äº‹ä»¶è¿½è¸ª", "è§‚ç‚¹ç¢°æ’", "ç¤¾ä¼šè°ƒæŸ¥", "çƒ­ç‚¹è®¨è®º", "å…¬æ°‘æ•™è‚²"],
                target_users: ["ç¤¾ä¼šè§‚å¯Ÿè€…", "å…¬æ°‘", "å­¦ç”Ÿ", "ç¤¾ä¼šæ´»åŠ¨å®¶"],
                value: "æå‡å…¬æ°‘ç¤¾ä¼šå‚ä¸æ„è¯†"
            },
            useful: {
                name: "ç¤¾ä¼šé—®é¢˜ç ”ç©¶å¹³å°",
                type: "Webå¹³å°",
                fun_score: 10,
                useful_score: 90,
                functions: ["é—®é¢˜åˆ†æ", "æ”¿ç­–è¯„ä¼°", "å½±å“ç ”ç©¶", "è§£å†³æ–¹æ¡ˆ", "ç¤¾ä¼šè°ƒç ”"],
                target_users: ["æ”¿ç­–åˆ¶å®šè€…", "ç¤¾ä¼šç ”ç©¶è€…", "NGO", "å…¬å…±çŸ¥è¯†åˆ†å­"],
                value: "ç§‘å­¦è§£å†³ç¤¾ä¼šé—®é¢˜"
            }
        },

        "å¥åº·": {
            fun: {
                name: `${topic.substring(0, 6)}å¥åº·ç®¡ç†`,
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 80,
                useful_score: 20,
                functions: ["å¥åº·æ¸¸æˆ", "ä¹ æƒ¯å…»æˆ", "æŒ‘æˆ˜æ‰“å¡", "å¥åº·é—®ç­”", "ç¤¾åŒºäº’åŠ¨"],
                target_users: ["å¥åº·å…³æ³¨è€…", "å¹´è½»äºº", "äºšå¥åº·äººç¾¤", "å¥èº«çˆ±å¥½è€…"],
                value: "è®©å¥åº·ç®¡ç†å˜å¾—æœ‰è¶£"
            },
            useful: {
                name: "å¥åº·æ•°æ®åˆ†æå¹³å°",
                type: "Webå¹³å°",
                fun_score: 15,
                useful_score: 85,
                functions: ["å¥åº·ç›‘æµ‹", "é£é™©è¯„ä¼°", "é¢„é˜²å»ºè®®", "åŒ»ç–—èµ„æº", "å¥åº·ç®¡ç†"],
                target_users: ["åŒ»ç–—æœºæ„", "å¥åº·ç®¡ç†å¸ˆ", "ç ”ç©¶æœºæ„", "æ”¿åºœéƒ¨é—¨"],
                value: "æå‡å…¬å…±å¥åº·ç®¡ç†æ°´å¹³"
            }
        },

        "æ•™è‚²": {
            fun: {
                name: `${topic.substring(0, 6)}å­¦ä¹ æ¸¸æˆ`,
                type: "å¾®ä¿¡å°ç¨‹åº",
                fun_score: 85,
                useful_score: 15,
                functions: ["çŸ¥è¯†é—¯å…³", "å­¦ä¹ ç«èµ›", "äº’åŠ¨æ•™å­¦", "æˆå°±ç³»ç»Ÿ", "å­¦ä¹ ç¤¾åŒº"],
                target_users: ["å­¦ç”Ÿ", "æ•™å¸ˆ", "å®¶é•¿", "æ•™è‚²çˆ±å¥½è€…"],
                value: "è®©å­¦ä¹ è¿‡ç¨‹æ›´æœ‰è¶£æœ‰æ•ˆ"
            },
            useful: {
                name: "æ•™è‚²è´¨é‡æ”¹è¿›å¹³å°",
                type: "Webå¹³å°",
                fun_score: 15,
                useful_score: 85,
                functions: ["è´¨é‡è¯„ä¼°", "æ•™å­¦åˆ†æ", "å­¦ç”Ÿå‘å±•", "èµ„æºä¼˜åŒ–", "æ”¿ç­–å»ºè®®"],
                target_users: ["å­¦æ ¡ç®¡ç†è€…", "æ•™è‚²éƒ¨é—¨", "æ•™ç ”å‘˜", "æ•™è‚²ç ”ç©¶è€…"],
                value: "æ•°æ®é©±åŠ¨æ•™è‚²è´¨é‡æå‡"
            }
        }
    };

    // è·å–åŸºäºåˆ†ç±»çš„åˆ›æ„ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é€šç”¨åˆ›æ„
    const categoryIdea = categoryIdeas[category] || categoryIdeas["ç¤¾ä¼š"];

    // ç‰¹æ®Šå¤„ç†ï¼šå¦‚æœæœ‰æœç´¢ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–åˆ›æ„
    if (contextInfo) {
        // å¯ä»¥æ ¹æ®å…·ä½“å†…å®¹è°ƒæ•´åˆ›æ„
        // è¿™é‡Œæš‚æ—¶ä¿æŒåˆ†ç±»åˆ›æ„ï¼Œåç»­å¯ä»¥æ›´ç²¾ç»†åŒ–
    }

    return [categoryIdea.fun, categoryIdea.useful];
}

// ç‰¹æ®Šè¯é¢˜åˆ›æ„ç”Ÿæˆå™¨
function generateSpecialIdea(topic, keyword, searchResult) {
    const specialIdeas = {
        // è¶…å¸‚ç¾½ç»’æœç›¸å…³
        'ç¾½ç»’æœ': () => {
            return [
                {
                    name: "ç¾½ç»’æœæ€§ä»·æ¯”é‰´å®šå¸ˆ",
                    type: "å¾®ä¿¡å°ç¨‹åº",
                    fun_score: 88,
                    useful_score: 12,
                    functions: [
                        "å……ç»’é‡è®¡ç®—å™¨ï¼šè¾“å…¥æ¸©åº¦å’Œä½“é‡ï¼Œæ™ºèƒ½æ¨èæ‰€éœ€å……ç»’é‡",
                        "ä»·æ ¼å¯¹æ¯”é›·è¾¾å›¾ï¼šåŒä»·ä½ç¾½ç»’æœå‚æ•°å¯è§†åŒ–å¯¹æ¯”",
                        "çœŸå‡é‰´åˆ«ARæ‰«æï¼šç”¨æ‰‹æœºæ‰«ææ ‡ç­¾ï¼ŒAIè¯†åˆ«çœŸä¼ª",
                        "ä¿æš–æŒ‡æ•°è®¡ç®—ï¼šåŸºäºå……ç»’é‡ã€è“¬æ¾åº¦è®¡ç®—å®é™…ä¿æš–æ•ˆæœ",
                        "ä»£è´­æ‹¼å›¢å°ç¨‹åºï¼šå±±å§†ã€èƒ–ä¸œæ¥ä»£è´­ä¿¡æ¯å®æ—¶æ›´æ–°"
                    ],
                    target_users: ["è¿½æ±‚æ€§ä»·æ¯”çš„æ¶ˆè´¹è€…", "ä¸­äº§å®¶åº­", "ä»£è´­ä»ä¸šè€…", "æœè£…ä»ä¸šè€…"],
                    value: "è®©æ¶ˆè´¹è€…ä¹°åˆ°çœŸæ­£æ€§ä»·æ¯”é«˜çš„ç¾½ç»’æœ"
                },
                {
                    name: "æœè£…ä¾›åº”é“¾é€æ˜åŒ–å¹³å°",
                    type: "Webå¹³å°",
                    fun_score: 10,
                    useful_score: 90,
                    functions: [
                        "å·¥å‚ç›´è¿ç³»ç»Ÿï¼šè¿æ¥åˆ¶é€ å•†å’Œæ¶ˆè´¹è€…ï¼Œæ¶ˆé™¤ä¸­é—´å•†",
                        "è´¨é‡æº¯æºç³»ç»Ÿï¼šæ¯ä¸ªæœè£…æ‰¹æ¬¡éƒ½æœ‰å”¯ä¸€è¿½æº¯ç ",
                        "æˆæœ¬é€æ˜åŒ–ï¼šå±•ç¤ºæœè£…ä»åŸæ–™åˆ°æˆå“çš„æˆæœ¬æ„æˆ",
                        "ç¯ä¿æŒ‡æ•°è¯„ä¼°ï¼šè¯„ä¼°ç”Ÿäº§è¿‡ç¨‹çš„ç¯å¢ƒå½±å“",
                        "æ¶ˆè´¹è€…è¯„ä»·é—­ç¯ï¼šçœŸå®ç”¨æˆ·è¯„ä»·é©±åŠ¨äº§å“æ”¹è¿›"
                    ],
                    target_users: ["æœè£…å“ç‰Œå•†", "æ¶ˆè´¹è€…æƒç›Šç»„ç»‡", "ç›‘ç®¡éƒ¨é—¨", "æŠ•èµ„æœºæ„"],
                    value: "æ¨åŠ¨æœè£…è¡Œä¸šä¾›åº”é“¾é€æ˜åŒ–ï¼Œä¿æŠ¤æ¶ˆè´¹è€…æƒç›Š"
                }
            ];
        },

        // åŒ»ä¿ç¼´è´¹ç›¸å…³
        'åŒ»ä¿': () => {
            return [
                {
                    name: "åŒ»ä¿æ™ºèƒ½ç¼´è´¹åŠ©æ‰‹",
                    type: "å¾®ä¿¡å°ç¨‹åº",
                    fun_score: 75,
                    useful_score: 25,
                    functions: [
                        "AIæ’é˜Ÿé¢„æµ‹ï¼šé¢„æµ‹æœ€ä½³ç¼´è´¹æ—¶é—´ï¼Œé¿å¼€é«˜å³°æœŸ",
                        "åŒ»ä¿å¡ä½™é¢æé†’ï¼šä½™é¢ä¸è¶³è‡ªåŠ¨æé†’å……å€¼",
                        "ç¼´è´¹å†å²å¯è§†åŒ–ï¼šå±•ç¤ºå†å¹´åŒ»ä¿ä½¿ç”¨æƒ…å†µ",
                        "å®¶åº­åŒ»ä¿ç®¡ç†ï¼šä¸€ä¸ªè´¦å·ç®¡ç†å…¨å®¶åŒ»ä¿ä¿¡æ¯",
                        "åŒ»é™¢æ’é˜Ÿä¼˜åŒ–ï¼šç»“åˆåŒ»ä¿ä½¿ç”¨æƒ…å†µæ¨èå°±è¯ŠåŒ»é™¢"
                    ],
                    target_users: ["ä¸Šç­æ—", "è€å¹´äºº", "å®¶åº­ä¸»å¦‡", "æ…¢æ€§ç—…æ‚£è€…"],
                    value: "è®©åŒ»ä¿ç¼´è´¹ä¸å†æ’é˜Ÿï¼Œè®©å°±åŒ»æ›´é«˜æ•ˆ"
                },
                {
                    name: "åŒ»ä¿å¤§æ•°æ®é£æ§ç³»ç»Ÿ",
                    type: "Webå¹³å°",
                    fun_score: 5,
                    useful_score: 95,
                    functions: [
                        "å¼‚å¸¸æ£€æµ‹AIï¼šè¯†åˆ«è™šå‡æŠ¥é”€å’Œè¿‡åº¦åŒ»ç–—",
                        "è´¹ç”¨é¢„æµ‹æ¨¡å‹ï¼šé¢„æµ‹ä¸ªäººå¹´åº¦åŒ»ä¿è´¹ç”¨",
                        "åŒ»é™¢è¯„çº§ç³»ç»Ÿï¼šåŸºäºåŒ»ä¿æ•°æ®è¯„ä¼°åŒ»é™¢æœåŠ¡è´¨é‡",
                        "æ”¿ç­–ä»¿çœŸæ¨¡æ‹Ÿï¼šé¢„æµ‹åŒ»ä¿æ”¿ç­–å˜åŒ–å¯¹ä¸ªäººçš„å½±å“",
                        "åæ¬ºè¯ˆé¢„è­¦ï¼šå®æ—¶ç›‘æ§å¼‚å¸¸åŒ»ä¿ä½¿ç”¨è¡Œä¸º"
                    ],
                    target_users: ["åŒ»ä¿å±€", "ä¿é™©å…¬å¸", "åŒ»é™¢ç®¡ç†è€…", "é£æ§ä¸“å®¶"],
                    value: "æå‡åŒ»ä¿åŸºé‡‘ç®¡ç†æ•ˆç‡ï¼Œå‡å°‘åŒ»ä¿æ¬ºè¯ˆ"
                }
            ];
        },

        // é«˜æ ¡æ•™è‚²ç›¸å…³
        'é«˜æ•°': () => {
            return [
                {
                    name: "é«˜æ•°å™©æ¢¦ç»ˆç»“è€…",
                    type: "å¾®ä¿¡å°ç¨‹åº",
                    fun_score: 92,
                    useful_score: 8,
                    functions: [
                        "å¾®ç§¯åˆ†æ¸¸æˆåŒ–ï¼šå°†æé™ã€å¯¼æ•°ã€ç§¯åˆ†å˜æˆé€šå…³æ¸¸æˆ",
                        "AIè§£é¢˜åŠ©æ‰‹ï¼šæ‹ç…§ä¸Šä¼ é¢˜ç›®ï¼ŒAIåˆ†æ­¥éª¤è¯¦ç»†è®²è§£",
                        "å­¦ä¼´åŒ¹é…ç³»ç»Ÿï¼šæ ¹æ®æ°´å¹³åŒ¹é…å­¦ä¹ å°ç»„å’Œç­”ç–‘ä¼™ä¼´",
                        "è¿›åº¦å¯è§†åŒ–ï¼šæŠŠæŠ½è±¡æ¦‚å¿µå˜æˆ3DåŠ¨ç”»å’Œäº¤äº’å›¾è¡¨",
                        "æ•™æˆç­”ç–‘ç›´æ’­ï¼šé‚€è¯·çŸ¥åæ•°å­¦æ•™æˆå®šæœŸåœ¨çº¿ç­”ç–‘"
                    ],
                    target_users: ["å·¥ç§‘å¤§å­¦ç”Ÿ", "è€ƒç ”å­¦ç”Ÿ", "æ•°å­¦çˆ±å¥½è€…", "åŸ¹è®­æœºæ„"],
                    value: "è®©é«˜æ•°å­¦ä¹ ä»ç—›è‹¦å˜æˆäº«å—"
                },
                {
                    name: "é«˜ç­‰æ•™è‚²è´¨é‡ç›‘æµ‹å¹³å°",
                    type: "Webå¹³å°",
                    fun_score: 10,
                    useful_score: 90,
                    functions: [
                        "è¯¾ç¨‹è´¨é‡è¯„ä¼°ï¼šåŸºäºå­¦ç”Ÿæˆç»©å’Œåé¦ˆè¯„ä¼°è¯¾ç¨‹æ•ˆæœ",
                        "æ•™å­¦æ–¹æ³•åˆ†æï¼šè¯†åˆ«é«˜æ•ˆæ•™å­¦æ–¹æ³•å’Œæ”¹è¿›å»ºè®®",
                        "å­¦ä¹ è·¯å¾„ä¼˜åŒ–ï¼šä¸ºæ¯ä¸ªå­¦ç”Ÿå®šåˆ¶ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„",
                        "å°±ä¸šè´¨é‡è¿½è¸ªï¼šè¿½è¸ªæ¯•ä¸šç”ŸèŒä¸šå‘å±•è½¨è¿¹",
                        "æ•™è‚²èµ„æºä¼˜åŒ–ï¼šåˆ†ææ•™è‚²èµ„æºåˆ†é…æ•ˆç‡"
                    ],
                    target_users: ["æ•™è‚²éƒ¨", "é«˜æ ¡ç®¡ç†è€…", "æ•™è‚²ç ”ç©¶è€…", "å­¦ç”Ÿå®¶é•¿"],
                    value: "æ•°æ®é©±åŠ¨é«˜ç­‰æ•™è‚²è´¨é‡æå‡"
                }
            ];
        },

        // æé™è¿åŠ¨ç›¸å…³
        'ç¿¼è£…': () => {
            return [
                {
                    name: "æé™è¿åŠ¨å®‰å…¨æ•™ç»ƒ",
                    type: "å¾®ä¿¡å°ç¨‹åº",
                    fun_score: 80,
                    useful_score: 20,
                    functions: [
                        "é£é™©è¯„ä¼°AIï¼šæ ¹æ®å¤©æ°”ã€åœ°å½¢ã€ç»éªŒè¯„ä¼°è¿åŠ¨é£é™©",
                        "å®‰å…¨è£…å¤‡æ£€æŸ¥æ¸…å•ï¼šæ¯æ¬¡è¿åŠ¨å‰AIæ£€æŸ¥è£…å¤‡å®Œæ•´æ€§",
                        "ç´§æ€¥æ•‘æ´å®šä½ï¼šè¿åŠ¨æ—¶å®æ—¶ä½ç½®å…±äº«ç»™æ•‘æ´å›¢é˜Ÿ",
                        "æé™è¿åŠ¨ç¤¾åŒºï¼šå®‰å…¨ç»éªŒåˆ†äº«å’Œäº‹æ•…é¢„è­¦",
                        "VRæ¨¡æ‹Ÿè®­ç»ƒï¼šåœ¨è™šæ‹Ÿç¯å¢ƒä¸­ç»ƒä¹ å„ç§æé™åŠ¨ä½œ"
                    ],
                    target_users: ["æé™è¿åŠ¨çˆ±å¥½è€…", "è¿åŠ¨ä¿±ä¹éƒ¨", "æ•‘æ´å›¢é˜Ÿ", "ä¿é™©å…¬å¸"],
                    value: "è®©æé™è¿åŠ¨åœ¨å¯æ§é£é™©ä¸‹è¿›è¡Œï¼Œä¿æŠ¤è¿åŠ¨è€…ç”Ÿå‘½"
                },
                {
                    name: "æé™è¿åŠ¨æ•°æ®åˆ†æå¹³å°",
                    type: "Webå¹³å°",
                    fun_score: 5,
                    useful_score: 95,
                    functions: [
                        "è¿åŠ¨æ•°æ®åˆ†æï¼šåˆ†æè¿åŠ¨å‚æ•°ä¸é£é™©çš„å…³ç³»",
                        "è£…å¤‡æ€§èƒ½è¯„ä¼°ï¼šè¯„ä¼°ä¸åŒè£…å¤‡çš„å®‰å…¨æ€§å’Œæ€§èƒ½",
                        "äº‹æ•…æ¡ˆä¾‹åº“ï¼šæ”¶é›†åˆ†ææé™è¿åŠ¨äº‹æ•…æ¡ˆä¾‹",
                        "æ”¿ç­–åˆ¶å®šæ”¯æŒï¼šä¸ºç›¸å…³å®‰å…¨æ”¿ç­–æä¾›æ•°æ®æ”¯æŒ",
                        "ä¿é™©äº§å“è®¾è®¡ï¼šåŸºäºé£é™©æ•°æ®è®¾è®¡ä¸ªæ€§åŒ–ä¿é™©"
                    ],
                    target_users: ["ä½“è‚²éƒ¨é—¨", "ä¿é™©å…¬å¸", "è£…å¤‡åˆ¶é€ å•†", "ç§‘ç ”æœºæ„"],
                    value: "æå‡æé™è¿åŠ¨å®‰å…¨ç®¡ç†æ°´å¹³"
                }
            ];
        },

        // å…»ç”Ÿå¥åº·ç›¸å…³
        'è‹¹æœ': () => {
            return [
                {
                    name: "è‹¹æœå…»ç”Ÿç™¾ç§‘å…¨ä¹¦",
                    type: "å¾®ä¿¡å°ç¨‹åº",
                    fun_score: 85,
                    useful_score: 15,
                    functions: [
                        "è‹¹æœå“ç§å¤§å…¨ï¼šæ”¶å½•å…¨çƒè‹¹æœå“ç§çš„è¥å…»æˆåˆ†å¯¹æ¯”",
                        "åƒæ³•åˆ›æ„å·¥åŠï¼šAIæ ¹æ®ä½“è´¨æ¨èè‹¹æœæ­é…æ–¹æ¡ˆ",
                        "å­£èŠ‚å…»ç”Ÿæ—¥å†ï¼šä¸åŒå­£èŠ‚åƒè‹¹æœçš„æœ€ä½³æ–¹å¼å’Œé‡",
                        "è¥å…»å¯è§†åŒ–ï¼šç”¨3Dæ¨¡å‹å±•ç¤ºè‹¹æœè¥å…»åœ¨ä½“å†…çš„ä½œç”¨",
                        "ç”¨æˆ·ç»éªŒåˆ†äº«ï¼šçœŸå®ç”¨æˆ·åˆ†äº«è‹¹æœå…»ç”Ÿå¿ƒå¾—"
                    ],
                    target_users: ["å…»ç”Ÿçˆ±å¥½è€…", "å‡è‚¥äººç¾¤", "å¥åº·å…³æ³¨è€…", "è¥å…»å¸ˆ"],
                    value: "è®©ç®€å•çš„è‹¹æœåƒå‡ºæœ€å¤§çš„å¥åº·ä»·å€¼"
                },
                {
                    name: "ä¸ªæ€§åŒ–è¥å…»å¥åº·å¹³å°",
                    type: "Webå¹³å°",
                    fun_score: 10,
                    useful_score: 90,
                    functions: [
                        "ä¸ªäººè¥å…»åŸºå› åˆ†æï¼šåŸºäºåŸºå› æ•°æ®å®šåˆ¶è¥å…»æ–¹æ¡ˆ",
                        "é£Ÿç‰©è¥å…»æ•°æ®åº“ï¼šå»ºç«‹å…¨é¢çš„é£Ÿç‰©è¥å…»æˆåˆ†æ•°æ®åº“",
                        "å¥åº·æ•ˆæœè¿½è¸ªï¼šé•¿æœŸè¿½è¸ªé¥®é£Ÿå¯¹å¥åº·æŒ‡æ ‡çš„å½±å“",
                        "è¥å…»å¸ˆAIåŠ©æ‰‹ï¼šä¸ºè¥å…»å¸ˆæä¾›ä¸“ä¸šå†³ç­–æ”¯æŒ",
                        "ä¾›åº”é“¾æº¯æºï¼šç¡®ä¿é£Ÿæçš„å®‰å…¨æ€§å’Œè¥å…»ä»·å€¼"
                    ],
                    target_users: ["è¥å…»å¸ˆ", "å¥åº·ç®¡ç†å¸ˆ", "åŒ»ç–—æœºæ„", "é£Ÿå“ä¼ä¸š"],
                    value: "è®©æ¯ä¸ªäººéƒ½èƒ½è·å¾—ä¸ªæ€§åŒ–çš„ç²¾å‡†è¥å…»æŒ‡å¯¼"
                }
            ];
        },

        // åˆ›å§‹äºº/ä¼ä¸šå®¶ç›¸å…³
        'åˆ›å§‹äºº': () => {
            return [
                {
                    name: "åˆ›ä¸šè€…æƒ…æŠ¥å±€",
                    type: "å¾®ä¿¡å°ç¨‹åº",
                    fun_score: 82,
                    useful_score: 18,
                    functions: [
                        "åˆ›å§‹äººåŠ¨æ€è¿½è¸ªï¼šè¿½è¸ªçŸ¥åä¼ä¸šå®¶çš„æœ€æ–°åŠ¨æ€",
                        "åˆ›ä¸šæ•…äº‹çŸ­è§†é¢‘ï¼šç”¨çŸ­è§†é¢‘è®²è¿°åˆ›ä¸šæ•…äº‹",
                        "æŠ•èµ„äººè„‰ç½‘ç»œï¼šè¿æ¥åˆ›ä¸šè€…å’ŒæŠ•èµ„äºº",
                        "åˆ›ä¸šç»éªŒåˆ†äº«ï¼šçœŸå®åˆ›ä¸šè€…åˆ†äº«ç»éªŒæ•™è®­",
                        "è¡Œä¸šè¶‹åŠ¿è§£è¯»ï¼šç”¨é€šä¿—è¯­è¨€è§£è¯»å•†ä¸šè¶‹åŠ¿"
                    ],
                    target_users: ["åˆ›ä¸šè€…", "æŠ•èµ„äºº", "å•†ä¸šçˆ±å¥½è€…", "å­¦ç”Ÿ"],
                    value: "è®©åˆ›ä¸šæ™ºæ…§è§¦æ‰‹å¯åŠ"
                },
                {
                    name: "ä¼ä¸šå†³ç­–æ”¯æŒç³»ç»Ÿ",
                    type: "Webå¹³å°",
                    fun_score: 10,
                    useful_score: 90,
                    functions: [
                        "å¸‚åœºæƒ…æŠ¥åˆ†æï¼šå®æ—¶åˆ†æå¸‚åœºç«äº‰æ€åŠ¿",
                        "å•†ä¸šæœºä¼šæŒ–æ˜ï¼šåŸºäºå¤§æ•°æ®æŒ–æ˜å•†ä¸šæœºä¼š",
                        "é£é™©é¢„è­¦ç³»ç»Ÿï¼šé¢„è­¦æ½œåœ¨çš„å•†ä¸šé£é™©",
                        "ç«äº‰å¯¹æ‰‹ç›‘æ§ï¼šç›‘æ§ç«äº‰å¯¹æ‰‹çš„åŠ¨æ€",
                        "æˆ˜ç•¥å†³ç­–æ¨¡æ‹Ÿï¼šæ¨¡æ‹Ÿä¸åŒå†³ç­–æ–¹æ¡ˆçš„ç»“æœ"
                    ],
                    target_users: ["ä¼ä¸šå®¶", "æŠ•èµ„æœºæ„", "å’¨è¯¢å…¬å¸", "åˆ†æå¸ˆ"],
                    value: "æ•°æ®é©±åŠ¨ä¼ä¸šæˆ˜ç•¥å†³ç­–"
                }
            ];
        },

        // ç§‘æŠ€å…¬å¸ç›¸å…³
        'Manus': () => {
            return [
                {
                    name: "Manusæ‰‹åŠ¿è¯†åˆ«ä½“éªŒé¦†",
                    type: "å¾®ä¿¡å°ç¨‹åº",
                    fun_score: 87,
                    useful_score: 13,
                    functions: [
                        "æ‰‹åŠ¿è¯†åˆ«æ¸¸æˆï¼šç”¨ç®€å•æ‰‹åŠ¿æ§åˆ¶æ¸¸æˆè§’è‰²",
                        "ARæ‰‹åŠ¿åº”ç”¨ï¼šç”¨æ‰‹åŠ¿åœ¨ç°å®ç©ºé—´ç»˜ç”»å’Œæ“ä½œ",
                        "æ‰‹åŠ¿æŒ‡ä»¤è®­ç»ƒï¼šè®­ç»ƒAIè¯†åˆ«ä¸ªäººç‹¬ç‰¹æ‰‹åŠ¿",
                        "æ— éšœç¢äº¤äº’ï¼šä¸ºæ®‹éšœäººå£«æä¾›æ‰‹åŠ¿è¾…åŠ©åŠŸèƒ½",
                        "æ‰‹åŠ¿åˆ›ä½œå·¥å…·ï¼šç”¨åˆ›æ„æ‰‹åŠ¿åˆ¶ä½œä¸ªæ€§åŒ–è¡¨æƒ…åŒ…"
                    ],
                    target_users: ["ç§‘æŠ€çˆ±å¥½è€…", "å¼€å‘è€…", "æ— éšœç¢è¾…åŠ©ç”¨æˆ·", "ARä½“éªŒè€…"],
                    value: "è®©æ‰‹åŠ¿æˆä¸ºæ–°çš„äº¤äº’è¯­è¨€"
                },
                {
                    name: "äººæœºäº¤äº’æŠ€æœ¯å¹³å°",
                    type: "Webå¹³å°",
                    fun_score: 12,
                    useful_score: 88,
                    functions: [
                        "æ‰‹åŠ¿è¯†åˆ«æŠ€æœ¯åˆ†æï¼šåˆ†æä¸åŒæ‰‹åŠ¿è¯†åˆ«æŠ€æœ¯çš„ä¼˜åŠ£åŠ¿",
                        "äº¤äº’è®¾è®¡ä¼˜åŒ–ï¼šä¼˜åŒ–äººæœºäº¤äº’ä½“éªŒ",
                        "æŠ€æœ¯åº”ç”¨æ¡ˆä¾‹ï¼šå±•ç¤ºæ‰‹åŠ¿è¯†åˆ«åœ¨å„è¡Œä¸šçš„åº”ç”¨",
                        "å¼€å‘è€…ç¤¾åŒºï¼šä¸ºå¼€å‘è€…æä¾›æŠ€æœ¯äº¤æµå¹³å°",
                        "æœªæ¥äº¤äº’è¶‹åŠ¿ï¼šé¢„æµ‹äººæœºäº¤äº’æŠ€æœ¯å‘å±•æ–¹å‘"
                    ],
                    target_users: ["æŠ€æœ¯å¼€å‘è€…", "äº§å“ç»ç†", "ç ”ç©¶æœºæ„", "ç§‘æŠ€å…¬å¸"],
                    value: "æ¨åŠ¨äººæœºäº¤äº’æŠ€æœ¯åˆ›æ–°å‘å±•"
                }
            ];
        }
    };

    return specialIdeas[keyword]();
}

async function analyzeAllTopics(hotList) {
    console.log("\nğŸ“Š æ­¥éª¤2: æ·±åº¦åˆ†æçƒ­æœè¯é¢˜...");
    console.log("-".repeat(70));

    const analysisResults = {
        "timestamp": new Date().toLocaleString('zh-CN'),
        "topics": []
    };

    // åªåˆ†æå‰10ä¸ªè¯é¢˜
    for (let i = 0; i < Math.min(10, hotList.length); i++) {
        const topic = hotList[i];
        const topicName = topic.hotword;
        const heat = topic.hotwordnum.trim();
        const tag = topic.hottag;

        console.log(`\n[${i + 1}/10] åˆ†æè¯é¢˜: ${topicName}`);
        console.log("-".repeat(70));

        // æœç´¢èƒŒæ™¯
        const searchResult = await searchTopicBackground(topicName);

        // åŸºç¡€ä¿¡æ¯
        const category = categorizeTopic(topicName);
        const topicAnalysis = {
            "name": topicName,
            "heat": heat,
            "tag": tag,
            "category": category,
            "search_result": searchResult,
            "background": extractBackground(searchResult, topicName),
        };

        // ç”Ÿæˆæ´å¯Ÿå’Œäº§å“åˆ›æ„
        topicAnalysis["insights"] = generateInsights(topicName, category);
        topicAnalysis["products"] = generateProductIdeas(topicName, category, searchResult);

        analysisResults["topics"].push(topicAnalysis);

        // æ˜¾ç¤ºç»“æœ
        console.log(`  âœ… åˆ†ç±»: ${topicAnalysis['category']}`);
        console.log(`  ğŸ’¡ æ´å¯Ÿ: ${topicAnalysis['insights']['user_pain_point'].substring(0, 50)}...`);
        console.log(`  ğŸ¯ äº§å“åˆ›æ„: ${topicAnalysis['products'][0]['name']}`);
        console.log(`    è¶£å‘³åº¦:${topicAnalysis['products'][0]['fun_score']}åˆ† æœ‰ç”¨åº¦:${topicAnalysis['products'][0]['useful_score']}åˆ†`);

        // é¿å…APIé¢‘ç‡é™åˆ¶
        await sleep(500);
    }

    return analysisResults;
}

function generateHtmlReport(analysisResults) {
    console.log("\nğŸ“„ æ­¥éª¤3: ç”ŸæˆHTMLæŠ¥å‘Š...");
    console.log("-".repeat(70));

    const dateStr = new Date().toISOString().slice(0, 10).replace(/-/g, '');
    const reportFilename = `weibo_analysis_report_${dateStr}.html`;

    const htmlContent = createHtmlTemplate(analysisResults);

    fs.writeFileSync(reportFilename, htmlContent, 'utf8');

    console.log(`âœ… æŠ¥å‘Šå·²ç”Ÿæˆ: ${reportFilename}`);
    return reportFilename;
}

function createHtmlTemplate(data) {
    let html = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®åšçƒ­æœåˆ†ææŠ¥å‘Š - ${data['timestamp']}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', sans-serif; line-height: 1.6; color: #333; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 10px; text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .summary { background: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .topic-card { background: white; margin-bottom: 30px; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .topic-header { background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; }
        .topic-title { font-size: 1.5em; margin-bottom: 10px; }
        .topic-meta { font-size: 0.9em; opacity: 0.9; }
        .topic-content { padding: 30px; }
        .section { margin-bottom: 25px; }
        .section-title { font-size: 1.3em; color: #667eea; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .product-card { background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; }
        .product-card h4 { color: #667eea; margin-bottom: 10px; }
        .tag { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 0.85em; margin-left: 10px; }
        .tag-hot { background: #ff6b6b; color: white; }
        .tag-new { background: #4ecdc4; color: white; }
        .tag-boil { background: #ffa502; color: white; }
        .sources { background: #f8f9fa; padding: 15px; border-radius: 8px; }
        .source-item { margin: 10px 0; padding: 10px; background: white; border-radius: 5px; }
        .footer { text-align: center; padding: 30px; color: #666; }
        ul { margin-left: 20px; }
        li { margin: 8px 0; }
        .score-badge { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 20px; display: inline-block; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¥ å¾®åšçƒ­æœåˆ†ææŠ¥å‘Š</h1>
            <p>æ·±åº¦æ´å¯Ÿ Â· èƒŒæ™¯è°ƒç ” Â· äº§å“åˆ›æ„</p>
            <p style="margin-top: 10px;">ç”Ÿæˆæ—¶é—´: ${data['timestamp']}</p>
        </div>

        <div class="summary">
            <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“Š æ•°æ®æ¦‚è§ˆ</h2>
            <p><strong>åˆ†æè¯é¢˜æ•°:</strong> ${data['topics'].length} ä¸ª</p>
            <p><strong>æ•°æ®æ¥æº:</strong> å¾®åšçƒ­æœ + ç™¾åº¦AIæœç´¢</p>
            <p><strong>åˆ†æç»´åº¦:</strong> èƒŒæ™¯è°ƒç ”ã€æ·±åº¦æ´å¯Ÿã€äº§å“åˆ›æ„</p>
        </div>
`;

    // æ·»åŠ æ¯ä¸ªè¯é¢˜çš„åˆ†æ
    data['topics'].forEach(topic => {
        let tagHtml = topic.tag ? `<span class="tag tag-${topic.tag.toLowerCase()}">${topic.tag}</span>` : '';

        html += `
        <div class="topic-card">
            <div class="topic-header">
                <h2 class="topic-title">
                    ${topic.name}
                    ${tagHtml}
                </h2>
                <div class="topic-meta">
                    çƒ­åº¦: ${topic.heat} | åˆ†ç±»: ${topic.category}
                </div>
            </div>
            <div class="topic-content">
                <div class="section">
                    <h3 class="section-title">ğŸ” èƒŒæ™¯æ¥é¾™å»è„‰</h3>
                    <div class="sources">
                        <p><strong>çŠ¶æ€:</strong> ${topic.background?.status || 'æœªè·å–'}</p>
`;

        // æ·»åŠ æœç´¢æ¥æº
        if (topic.background && topic.background.sources && topic.background.sources.length > 0) {
            topic.background.sources.slice(0, 2).forEach(source => {
                html += `
                        <div class="source-item">
                            <strong>æ¥æº:</strong> ${source.title}<br>
                            <strong>æ‘˜å½•:</strong> ${source.content}<br>
                            <strong>é“¾æ¥:</strong> <a href="${source.url}" target="_blank">${source.url}</a>
                        </div>
`;
            });
        } else {
            html += `
                        <p style="color: #999; font-style: italic;">æ³¨: èƒŒæ™¯ä¿¡æ¯éœ€ä½¿ç”¨ç™¾åº¦APIå®æ—¶æœç´¢è·å–</p>
`;
        }

        html += `
                    </div>
                </div>

                <div class="section">
                    <h3 class="section-title">ğŸ’¡ æ·±åº¦åˆ†æ</h3>
                    <p><strong>ç”¨æˆ·ç—›ç‚¹:</strong> ${topic.insights.user_pain_point}</p>
                    <p><strong>å¸‚åœºæœºä¼š:</strong> ${topic.insights.market_opportunity}</p>
                    <p><strong>åˆ›æ–°æ–¹å‘:</strong> ${topic.insights.innovation_direction}</p>
                </div>

                <div class="section">
                    <h3 class="section-title">ğŸ¯ è½¯ä»¶äº§å“åˆ›æ„</h3>
                    <div class="product-grid">
`;

        // æ·»åŠ äº§å“åˆ›æ„
        topic.products.forEach((product, index) => {
            html += `
                        <div class="product-card">
                            <h4>ã€äº§å“${index + 1}ã€‘${product.name}</h4>
                            <p><strong>ç±»å‹:</strong> ${product.type}</p>
                            <div class="score-badge">
                                è¶£å‘³åº¦:${product.fun_score}åˆ† | æœ‰ç”¨åº¦:${product.useful_score}åˆ†
                            </div>
                            <p><strong>æ ¸å¿ƒåŠŸèƒ½:</strong></p>
                            <ul>
`;
            product.functions.forEach(func => {
                html += `                                <li>${func}</li>\n`;
            });

            html += `
                            </ul>
                            <p><strong>ç›®æ ‡ç”¨æˆ·:</strong> ${product.target_users.join(', ')}</p>
                            <p><strong>å•†ä¸šä»·å€¼:</strong> ${product.value}</p>
                        </div>
`;
        });

        html += `
                    </div>
                </div>
            </div>
        </div>
`;
    });

    // æ·»åŠ é¡µè„š
    html += `
        <div class="footer">
            <p>Â© 2025 å¾®åšçƒ­æœåˆ†æç³»ç»Ÿ | æ–œæ å‘½ä»¤: /weibo-analysis</p>
            <p style="margin-top: 10px; font-size: 0.9em;">
                æœ¬æŠ¥å‘Šç”±Claude Codeè‡ªåŠ¨ç”Ÿæˆ | åŸºäºçœŸå®APIæ•°æ®
            </p>
        </div>
    </div>
</body>
</html>
`;
    return html;
}

function saveResults(data) {
    const timestamp = new Date().toISOString().slice(0, 16).replace(/[-:T]/g, '');
    const filename = `weibo_analysis_results_${timestamp}.json`;

    fs.writeFileSync(filename, JSON.stringify(data, null, 2), 'utf8');

    console.log(`ğŸ’¾ åˆ†æç»“æœå·²ä¿å­˜: ${filename}`);
    return filename;
}

function printSummary(analysisResults, reportFile) {
    console.log("\n" + "=".repeat(70));
    console.log("âœ… å¾®åšçƒ­æœåˆ†æå®Œæˆï¼");
    console.log("=".repeat(70));
    console.log(`ğŸ“Š åˆ†æè¯é¢˜æ•°: ${analysisResults['topics'].length}`);
    console.log(`ğŸ“„ æŠ¥å‘Šæ–‡ä»¶: ${reportFile}`);
    const timestamp = new Date().toISOString().slice(0, 16).replace(/[-:T]/g, '');
    console.log(`ğŸ“ ç»“æœæ–‡ä»¶: weibo_analysis_results_${timestamp}.json`);
    console.log("=".repeat(70));
    console.log("\nğŸ’¡ æç¤º:");
    console.log("   1. æ‰“å¼€HTMLæŠ¥å‘ŠæŸ¥çœ‹å®Œæ•´åˆ†æç»“æœ");
    console.log("   2. ä½¿ç”¨ /weibo-analysis å‘½ä»¤å¯é‡æ–°è¿è¡Œåˆ†æ");
    console.log("   3. æ¯ä¸ªè¯é¢˜éƒ½åŒ…å«èƒŒæ™¯è°ƒç ”å’Œäº§å“åˆ›æ„");
    console.log("=".repeat(70));
}

// ==================== ä¸»å‡½æ•° ====================

async function main() {
    printHeader();

    try {
        // 1. è·å–çƒ­æœæ•°æ®
        const hotData = await getWeiboHotData();
        if (!hotData) {
            console.log("âŒ æ— æ³•è·å–çƒ­æœæ•°æ®ï¼Œç¨‹åºé€€å‡º");
            return;
        }

        // 2. åˆ†ææ‰€æœ‰è¯é¢˜
        const analysisResults = await analyzeAllTopics(hotData.list);

        // 3. ä¿å­˜ç»“æœ
        const resultsFile = saveResults(analysisResults);

        // 4. ç”ŸæˆHTMLæŠ¥å‘Š
        const reportFile = generateHtmlReport(analysisResults);

        // 5. æ‰“å°æ€»ç»“
        printSummary(analysisResults, reportFile);

    } catch (e) {
        console.log(`\nâŒ ç¨‹åºæ‰§è¡Œå‡ºé”™: ${e.message}`);
        console.error(e);
    }
}

// è¿è¡Œä¸»å‡½æ•°
main();